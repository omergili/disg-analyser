<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myLurch – DISG Kommunikations-Analyse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }
        .quadrant-card {
            transition: all 0.2s ease;
        }
        .quadrant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 41, 59, 0.15);
        }
        .btn-primary {
            background: #1e293b;
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            background: #334155;
        }
        .btn-secondary {
            border: 2px solid #1e293b;
            color: #1e293b;
            transition: all 0.2s ease;
        }
        .btn-secondary:hover {
            background: #f8fafc;
        }
        #rewriteSection {
            scroll-margin-top: 2rem;
        }
    </style>
</head>
<body class="bg-white">
    <!-- Header -->
    <header class="bg-slate-900 text-white py-6 shadow-md">
        <div class="max-w-7xl mx-auto px-4">
            <h1 class="text-3xl font-bold tracking-tight">myLurch</h1>
            <p class="text-slate-300 mt-1">DISG Kommunikations-Analyse</p>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="bg-slate-50 py-8 border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-2xl font-semibold text-slate-900 mb-2">
                Präzise Kommunikation durch Perspektivwechsel
            </h2>
            <p class="text-slate-600 max-w-2xl mx-auto">
                Analyse und Optimierung von Nachrichten basierend auf DISG-Persönlichkeitsprofilen
            </p>
        </div>
    </section>

    <!-- Main Tool Section -->
    <main class="max-w-7xl mx-auto px-4 py-12">
        <!-- Input Section -->
        <div class="bg-white border-2 border-slate-200 rounded-lg p-8 mb-8 shadow-sm">
            <label for="messageInput" class="block text-lg font-semibold text-slate-900 mb-3">
                Nachricht eingeben
            </label>
            <textarea 
                id="messageInput" 
                rows="5" 
                class="w-full p-4 border-2 border-slate-300 rounded-lg focus:border-slate-900 focus:ring-2 focus:ring-slate-200 outline-none transition font-mono text-sm"
                placeholder="Nachricht hier eingeben..."
            ></textarea>
            
            <div class="mt-6 flex flex-col sm:flex-row gap-3">
                <button 
                    id="analyzeBtn"
                    class="btn-primary text-white font-semibold py-3 px-8 rounded-lg flex-1 sm:flex-initial"
                >
                    Analysieren
                </button>
                <div class="flex gap-2 flex-wrap">
                    <button class="btn-secondary font-medium py-3 px-6 rounded-lg rewrite-btn" data-type="d">
                        Auf D umschreiben
                    </button>
                    <button class="btn-secondary font-medium py-3 px-6 rounded-lg rewrite-btn" data-type="i">
                        Auf I umschreiben
                    </button>
                    <button class="btn-secondary font-medium py-3 px-6 rounded-lg rewrite-btn" data-type="s">
                        Auf S umschreiben
                    </button>
                    <button class="btn-secondary font-medium py-3 px-6 rounded-lg rewrite-btn" data-type="g">
                        Auf G umschreiben
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Grid -->
        <div id="resultsSection" class="mb-12">
            <h3 class="text-xl font-semibold text-slate-900 mb-6">Perspektivanalyse</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- D - Dominant -->
                <div class="quadrant-card bg-white border-2 border-slate-200 rounded-lg p-6">
                    <div class="flex items-center mb-4 pb-3 border-b border-slate-200">
                        <div class="w-3 h-8 bg-red-600 rounded mr-3"></div>
                        <div>
                            <h4 class="text-lg font-bold text-slate-900">Dominant (D)</h4>
                            <p class="text-sm text-slate-600">Ergebnisorientiert, direkt</p>
                        </div>
                    </div>
                    <div id="result-d" class="text-slate-700 leading-relaxed min-h-[80px]">
                        <p class="text-slate-400 italic">Wartet auf Eingabe</p>
                    </div>
                </div>

                <!-- I - Initiativ -->
                <div class="quadrant-card bg-white border-2 border-slate-200 rounded-lg p-6">
                    <div class="flex items-center mb-4 pb-3 border-b border-slate-200">
                        <div class="w-3 h-8 bg-yellow-500 rounded mr-3"></div>
                        <div>
                            <h4 class="text-lg font-bold text-slate-900">Initiativ (I)</h4>
                            <p class="text-sm text-slate-600">Kommunikativ, enthusiastisch</p>
                        </div>
                    </div>
                    <div id="result-i" class="text-slate-700 leading-relaxed min-h-[80px]">
                        <p class="text-slate-400 italic">Wartet auf Eingabe</p>
                    </div>
                </div>

                <!-- S - Stetig -->
                <div class="quadrant-card bg-white border-2 border-slate-200 rounded-lg p-6">
                    <div class="flex items-center mb-4 pb-3 border-b border-slate-200">
                        <div class="w-3 h-8 bg-green-600 rounded mr-3"></div>
                        <div>
                            <h4 class="text-lg font-bold text-slate-900">Stetig (S)</h4>
                            <p class="text-sm text-slate-600">Geduldig, teamorientiert</p>
                        </div>
                    </div>
                    <div id="result-s" class="text-slate-700 leading-relaxed min-h-[80px]">
                        <p class="text-slate-400 italic">Wartet auf Eingabe</p>
                    </div>
                </div>

                <!-- G - Gewissenhaft -->
                <div class="quadrant-card bg-white border-2 border-slate-200 rounded-lg p-6">
                    <div class="flex items-center mb-4 pb-3 border-b border-slate-200">
                        <div class="w-3 h-8 bg-blue-600 rounded mr-3"></div>
                        <div>
                            <h4 class="text-lg font-bold text-slate-900">Gewissenhaft (G)</h4>
                            <p class="text-sm text-slate-600">Analytisch, präzise</p>
                        </div>
                    </div>
                    <div id="result-g" class="text-slate-700 leading-relaxed min-h-[80px]">
                        <p class="text-slate-400 italic">Wartet auf Eingabe</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rewrite Result Section -->
        <div id="rewriteSection" class="mb-12 hidden">
            <h3 class="text-xl font-semibold text-slate-900 mb-4">Umgeschriebene Nachricht</h3>
            <div class="bg-slate-50 border-2 border-slate-200 rounded-lg p-6">
                <div id="rewriteResult" class="text-slate-700 leading-relaxed whitespace-pre-wrap"></div>
                <button id="copyBtn" class="mt-4 btn-secondary font-medium py-2 px-6 rounded-lg">
                    In Zwischenablage kopieren
                </button>
            </div>
        </div>

        <!-- Info Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pt-12 border-t-2 border-slate-200">
            <!-- Der Nutzen -->
            <div>
                <h3 class="text-xl font-bold text-slate-900 mb-4">Der Nutzen</h3>
                <div class="text-slate-700 space-y-3 leading-relaxed">
                    <p>
                        <strong>Missverständnisse vermeiden:</strong> Unterschiedliche Persönlichkeitstypen interpretieren 
                        identische Nachrichten verschieden. Was für einen direkten D-Typ klar ist, wirkt auf einen 
                        harmoniebedürftigen S-Typ möglicherweise zu hart.
                    </p>
                    <p>
                        <strong>Effizienz steigern:</strong> Durch Anpassung der Kommunikation an den Empfänger 
                        werden Rückfragen minimiert und Entscheidungen beschleunigt.
                    </p>
                    <p>
                        <strong>Konflikte reduzieren:</strong> Präventive Kommunikationsoptimierung verhindert 
                        unnötige Reibungspunkte im Team und mit Stakeholdern.
                    </p>
                    <p>
                        <strong>Anwendungsbereich:</strong> E-Mails, Meetings, Präsentationen, Feedback-Gespräche, 
                        Change Management.
                    </p>
                </div>
            </div>

            <!-- Das Modell -->
            <div>
                <h3 class="text-xl font-bold text-slate-900 mb-4">Das Modell</h3>
                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="w-4 h-4 bg-red-600 rounded mr-3 mt-1 flex-shrink-0"></div>
                        <div>
                            <h4 class="font-semibold text-slate-900">Dominant (D)</h4>
                            <p class="text-sm text-slate-600">
                                Fokus auf Ergebnisse und Kontrolle. Direkte Kommunikation, schnelle Entscheidungen, 
                                ungeduldig bei Details.
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-4 h-4 bg-yellow-500 rounded mr-3 mt-1 flex-shrink-0"></div>
                        <div>
                            <h4 class="font-semibold text-slate-900">Initiativ (I)</h4>
                            <p class="text-sm text-slate-600">
                                Fokus auf Menschen und Beziehungen. Enthusiastisch, kommunikativ, optimistisch, 
                                beziehungsorientiert.
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-4 h-4 bg-green-600 rounded mr-3 mt-1 flex-shrink-0"></div>
                        <div>
                            <h4 class="font-semibold text-slate-900">Stetig (S)</h4>
                            <p class="text-sm text-slate-600">
                                Fokus auf Stabilität und Teamarbeit. Geduldig, loyal, harmoniebedürftig, 
                                bevorzugt bewährte Prozesse.
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-4 h-4 bg-blue-600 rounded mr-3 mt-1 flex-shrink-0"></div>
                        <div>
                            <h4 class="font-semibold text-slate-900">Gewissenhaft (G)</h4>
                            <p class="text-sm text-slate-600">
                                Fokus auf Qualität und Genauigkeit. Analytisch, detailorientiert, präzise, 
                                faktenbasiert.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm">myLurch – DISG Kommunikations-Analyse</p>
            <p class="text-xs mt-2">Powered by Groq AI</p>
        </div>
    </footer>

    <script>
        const messageInput = document.getElementById('messageInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const rewriteBtns = document.querySelectorAll('.rewrite-btn');
        const copyBtn = document.getElementById('copyBtn');
        const rewriteSection = document.getElementById('rewriteSection');
        const rewriteResult = document.getElementById('rewriteResult');
        
        const results = {
            d: document.getElementById('result-d'),
            i: document.getElementById('result-i'),
            s: document.getElementById('result-s'),
            g: document.getElementById('result-g')
        };

        const typeInfo = {
            d: {
                name: 'Dominant',
                traits: 'direkt, ergebnisorientiert, entscheidungsfreudig, ungeduldig',
                focus: 'Fokus auf Ergebnisse und Kontrolle'
            },
            i: {
                name: 'Initiativ',
                traits: 'enthusiastisch, kommunikativ, optimistisch, beziehungsorientiert',
                focus: 'Fokus auf Menschen und positive Energie'
            },
            s: {
                name: 'Stetig',
                traits: 'geduldig, loyal, kooperativ, harmoniebedürftig',
                focus: 'Fokus auf Stabilität und Teamarbeit'
            },
            g: {
                name: 'Gewissenhaft',
                traits: 'analytisch, präzise, detailorientiert, qualitätsbewusst',
                focus: 'Fokus auf Genauigkeit und Qualität'
            }
        };

        // Analyze function
        analyzeBtn.addEventListener('click', async () => {
            const text = messageInput.value.trim();
            
            if (!text) {
                alert('Bitte Nachricht eingeben.');
                return;
            }

            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Analysiere...';
            rewriteSection.classList.add('hidden');

            Object.values(results).forEach(el => {
                el.innerHTML = '<p class="text-slate-400 italic">Wird analysiert...</p>';
            });

            try {
                await Promise.all([
                    analyzeType('d', text),
                    analyzeType('i', text),
                    analyzeType('s', text),
                    analyzeType('g', text)
                ]);
            } catch (error) {
                console.error('Fehler:', error);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analysieren';
            }
        });

        async function analyzeType(type, text) {
            const info = typeInfo[type];
            
            // Hochwertiger System-Prompt mit Bezug auf "Der Nutzen"
            const prompt = `Du bist ein professioneller DISG-Kommunikationsberater. Analysiere die folgende Nachricht aus der Perspektive eines ${info.name}-Typs.

DISG-Profil: ${info.name} (${info.traits}). ${info.focus}.

Nachricht: "${text}"

AUFGABE: Erstelle eine präzise, professionelle Analyse (2-3 Sätze), die zeigt:

1. Wie dieser Persönlichkeitstyp die Nachricht interpretiert und welche Aspekte er priorisiert
2. Welche potenziellen Missverständnisse oder Ineffizienzen entstehen könnten
3. Konkrete Hinweise darauf, wie die Nachricht optimiert werden könnte, um Konflikte zu reduzieren

KONTEXT: 
- Wenn die Nachricht zu vage ist, erkläre explizit, warum dies zu Ineffizienz führt
- Wenn die Nachricht zu direkt/hart ist, weise auf Konfliktpotential hin
- Wenn wichtige Details fehlen (bei G-Typ), benenne diese konkret

Antworte sachlich, direkt und handlungsorientiert. Keine Floskeln, nur relevante Insights.`;

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type, text: prompt })
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);

                const data = await response.json();
                results[type].innerHTML = `<p>${data.result}</p>`;
            } catch (error) {
                results[type].innerHTML = '<p class="text-red-600">Fehler bei der Analyse.</p>';
                throw error;
            }
        }

        // Rewrite function
        rewriteBtns.forEach(btn => {
            btn.addEventListener('click', async () => {
                const targetType = btn.dataset.type;
                const text = messageInput.value.trim();
                
                if (!text) {
                    alert('Bitte Nachricht eingeben.');
                    return;
                }

                btn.disabled = true;
                const originalText = btn.textContent;
                btn.textContent = 'Schreibt um...';

                rewriteSection.classList.remove('hidden');
                rewriteResult.textContent = 'Nachricht wird umgeschrieben...';

                // Sanfte Scroll-Animation zum Rewrite-Bereich
                setTimeout(() => {
                    rewriteSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start'
                    });
                }, 100);

                try {
                    const info = typeInfo[targetType];
                    
                    // Hochwertiger Umschreib-Prompt
                    const prompt = `Du bist ein professioneller Kommunikationsberater mit Expertise in DISG-Modellen. Transformiere die folgende Nachricht für einen ${info.name}-Typ.

ZIEL-PROFIL: ${info.name}
- Merkmale: ${info.traits}
- ${info.focus}

ORIGINAL-NACHRICHT:
"${text}"

AUFGABE: Schreibe die Nachricht komplett um, sodass sie:

1. DIE SPRACHE DES ZIELTYPS SPIEGELT:
   ${targetType === 'd' ? '- Direkt, knapp, ergebnisorientiert\n   - Klare Handlungsaufforderungen\n   - Bottom-Line zuerst\n   - Keine Umschweife' : ''}
   ${targetType === 'i' ? '- Enthusiastisch, positiv formuliert\n   - Persönliche Ansprache\n   - Vision und Möglichkeiten betonen\n   - Beziehungsaspekte einbeziehen' : ''}
   ${targetType === 's' ? '- Ruhig, unterstützend, teamorientiert\n   - Betonung von Gemeinsamkeit ("wir")\n   - Schrittweise Herangehensweise\n   - Stabilität und Sicherheit vermitteln' : ''}
   ${targetType === 'g' ? '- Faktenbasiert, präzise, strukturiert\n   - Daten und Details einbeziehen\n   - Logische Argumentation\n   - Qualitätsorientierung betonen' : ''}

2. KONFLIKTE REDUZIERT:
   - Potentielle Missverständnisse eliminieren
   - Triggerpunkte des Typs vermeiden
   - Optimale Empfangsbereitschaft schaffen

3. KERNBOTSCHAFT BEIBEHÄLT:
   - Inhaltlich identisch
   - Nur Ton, Struktur und Formulierung anpassen

Gib NUR die umgeschriebene Nachricht zurück. Keine Erklärungen, keine Metakommentare, keine Anführungszeichen am Anfang/Ende.`;

                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type: targetType, text: prompt })
                    });

                    if (!response.ok) throw new Error(`API Error: ${response.status}`);

                    const data = await response.json();
                    
                    // Entferne eventuelle Anführungszeichen am Anfang/Ende
                    let result = data.result.trim();
                    if ((result.startsWith('"') && result.endsWith('"')) || 
                        (result.startsWith("'") && result.endsWith("'"))) {
                        result = result.slice(1, -1);
                    }
                    
                    rewriteResult.textContent = result;
                } catch (error) {
                    rewriteResult.textContent = 'Fehler beim Umschreiben. Bitte versuchen Sie es erneut.';
                    console.error('Fehler:', error);
                } finally {
                    btn.disabled = false;
                    btn.textContent = originalText;
                }
            });
        });

        // Copy function
        copyBtn.addEventListener('click', () => {
            const text = rewriteResult.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Kopiert!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            });
        });

        // Enter to submit
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                analyzeBtn.click();
            }
        });
    </script>
</body>
</html>
